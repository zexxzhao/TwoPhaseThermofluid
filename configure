###################################
# Default ENV VAR
###################################

CC='mpicc'
FC='mpif90'
PREFIX=${PWD}/install/


CONFIGFILE=make.config
if [ -f ${CONFIGFILE} ]; then
    bash -c "rm ${CONFIGFILE}"
fi

echo "PREFIX:=${PREFIX}">> ${CONFIGFILE}
##echo "DIRECTORY:=${PREFIX}">> ${CONFIGFILE}

echo "BIN_INSTALL:=${PREFIX}/bin">> ${CONFIGFILE}
echo "LIB_INSTALL:=${PREFIX}/lib">> ${CONFIGFILE}
echo "INC_INSTALL:=${PREFIX}/include">> ${CONFIGFILE}

echo >> ${CONFIGFILE}

#########################
# CONFIGURE GFORTRAN FLASG BASED ON GNU VERSION
#########################
echo "FC=${FC}">> ${CONFIGFILE}
GCC_VERSION=$(${CC} --version | awk '/gcc/ {print $3+0}')

if [ $(echo "${GCC_VERSION} >= 10.0" | bc -l) -eq 1 ];
then
    echo "FFLAGS:=-O3 -g -fPIC -fbounds-check -fcheck=mem -fallow-argument-mismatch" >> ${CONFIGFILE}
else
    echo "FFLAGS:=-O2 -g -fPIC -fbounds-check -fcheck=mem" >> ${CONFIGFILE}
fi

echo >> ${CONFIGFILE}
echo "CC=${CC}">> ${CONFIGFILE}
echo "CFLAGS:=-O2 -g -fPIC -DHAVE_MPI " >> ${CONFIGFILE}

#########################
# CONFIGURE INC & LIB 
#########################

echo >> ${CONFIGFILE}
echo  "LIBS=" >> ${CONFIGFILE}
echo  "INC=" >> ${CONFIGFILE}

#########################
# Linker
#########################

echo >> ${CONFIGFILE}
echo "AR:=ar" >> ${CONFIGFILE}
echo "ARFLAGS:=rcs" >> ${CONFIGFILE}
echo "STATIC_LIB_SUFFIX:=.a" >> ${CONFIGFILE}
echo "SHARED_LIB_SUFFIX:=.so" >> ${CONFIGFILE}

echo "EXE_SUFFIX:=.exe" >> ${CONFIGFILE}

#########################
# CONFIGURE MPI FLAGS 
#########################

echo >> ${CONFIGFILE}
MPI_FLAGS=$(${FC} -show | sed 's/[^ ]* //')
echo "MPI_FLAGS=${MPI_FLAGS}" >> ${CONFIGFILE}

echo >> ${CONFIGFILE}


cat ${CONFIGFILE}
